<html lang="en">
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Adding Your First User | Fin Example Repository Documentation</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Adding Your First User" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="http://localhost:4000/fin-example-repository/adding-your-first-user/" />
<meta property="og:url" content="http://localhost:4000/fin-example-repository/adding-your-first-user/" />
<meta property="og:site_name" content="Fin Example Repository Documentation" />
<script type="application/ld+json">
{"@type":"WebPage","headline":"Adding Your First User","url":"http://localhost:4000/fin-example-repository/adding-your-first-user/","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<title>Adding Your First User</title>
    <link rel="stylesheet" href="/fin-example-repository/assets/main.css">
    <link rel="stylesheet" href="/fin-example-repository/assets/css/styles.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/fin-example-repository/feed.xml" title="Fin Example Repository Documentation" /></head>
  <body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/fin-example-repository/">Fin Example Repository Documentation</a>

    <!--<nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/fin-example-repository/about/">About</a><a class="page-link" href="/fin-example-repository/accessing-the-ldp-server/">Accessing the LDP Server</a><a class="page-link" href="/fin-example-repository/adding-data/">Adding Data to the Repository</a><a class="page-link" href="/fin-example-repository/adding-your-first-user/">Adding Your First User</a><a class="page-link" href="/fin-example-repository/advanced-configuration/">Advanced Configuration</a><a class="page-link" href="/fin-example-repository/configuration/">Configuration</a><a class="page-link" href="/fin-example-repository/examples/ex1-pets/">Example 1 - Collaborator Pets</a><a class="page-link" href="/fin-example-repository/examples/ex2-photos/">Example 2 - Photographs</a><a class="page-link" href="/fin-example-repository/examples/ex3-sherry-lehmann/">Example 3 - Sherry Lehmann Collection</a><a class="page-link" href="/fin-example-repository/example-collections/">Example Collections</a><a class="page-link" href="/fin-example-repository/installation/">Installation</a><a class="page-link" href="/fin-example-repository/prerequisites/">Prerequisites</a></div>
      </nav>-->
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Adding Your First User</h1>
  </header>

  <div class="post-content">
    <h2 id="basic-auth">Basic-Auth</h2>

<p>Our container setup separates the authentication step from the Fedora and
other services.  The services rely on valid JWT tokens being sent along with
requests to the system.  The Authentication services are what creates these
tokens.  In production, you will most certainly want to use a centralized
authentication mechanism, see <a href="#CAS-Authentication">CAS Authentication</a> in the <a href="../advanced-configuration">Advanced Configuration</a> section to see an example of this type of setup.  However, for
testing, we have included a Basic Authentication service that can be used
without any external setup.  You should really only use this service for
testing.</p>

<p>Earlier, we looked at some of the container processes we were running with
<code class="highlighter-rouge">docker-compose -f fin-example.yml ps</code>. One process there, is there is the
basic-auth service.  In addition, by default we allow anyone to <a href="https://itcatalog.ucdavis.edu/service/central-authentication-service-cas">create a new
user account</a>. Navigate to that
location and create a new user.  The email address allows for password resets.
Once you’ve created your account, you can login to the server, and then from the
home page, you can verify that you are logged in via the lower right hand side
of the page.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  docker-compose <span class="nt">-f</span> fin-example.yml <span class="nb">exec </span>basic-auth node service/cli create-user <span class="nt">-u</span> quinn <span class="nt">-p</span> laxlax <span class="nt">-e</span> quinn@example.org
</code></pre></div></div>

<p>Now, we are going to give the user we’ve just created special administrative
privileges for our repository.  This cannot be done via the website, but can be
done with a command in your docker setup.  Assuming the user you’ve added, and
who will be your admin is <code class="highlighter-rouge">superman</code>, run the command below:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose <span class="nt">-f</span> fin-example.yml <span class="nb">exec </span>server node app/cli admin add-admin <span class="nt">-u</span> quinn@local
</code></pre></div></div>

<p>This command adds the user <code class="highlighter-rouge">superman@local</code> into the group of administrators for
the repository.   Every user in our Basic-Auth setup is given the <code class="highlighter-rouge">@local</code>
suffix to differentiate them from other authentication systems.  Now in your
browser, logout and back in (using the links in the lower right), to give
yourself these new privileges.</p>

<p><em><strong>Pro Tip</strong> if you understand the development setup of your browser, you will
see that this process has added a Cookie <code class="highlighter-rouge">fin-jwt</code> that encapsulates this
information.  For example, you could copy that jwt token and decode it, for
example by visiting <a href="https://jwt.io/">jwt.io</a>. You will see the values encoded
in the token.  You can even verify the signature if you include the <code class="highlighter-rouge">JWT_SECRET</code>
you’ve set in your configuration.  This should show you how easy it is to create
tokens if you know that <code class="highlighter-rouge">JWT_SECRET</code>, keep it hidden keep it safe!</em></p>

<p><a id="CAS-Authentication"></a></p>

<h2 id="cas-authentication">CAS Authentication</h2>

<p>The examples above includes a Basic Authentication service, but even in
development, we often don’t use this service. Instead, we have an authentication
service using the CAS service used on our UC Davis campus. When using this
service, the authentication of the users is sent to the central CAS
authentication server, and if the user authenticates, the service will mint a
token for this users.  There aren’t too many differences in the overall setup.
First, open the fin-example.yml file, remove the Basic-Authentication Service, and add the CAS service.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- fin-example.yml	2018-03-01 17:05:14.964623572 -0800
</span><span class="gi">+++ fin-example-cas.yml	2018-03-01 17:05:26.192623341 -0800
</span><span class="p">@@ -103,10 +103,10 @@</span>
       - server

   ###
<span class="gd">-  # Basic Username/Password AuthenticationService
</span><span class="gi">+  # CAS AuthenticationService
</span>   ###
<span class="gd">-  basic-auth:
-    image: ucdlib/fin-basic-auth:master
</span><span class="gi">+  cas:
+    image: ucdlib/fin-cas-service:master
</span>     env_file:
       - fin-example.env
     depends_on:
</code></pre></div></div>

<p>Then, when we create admins we make sure to use the <code class="highlighter-rouge">@ucdavis.edu</code> suffix for
these users, as in:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose <span class="nt">-f</span> fin-example.yml <span class="nb">exec </span>server node app/cli admin add-admin <span class="nt">-u</span> quinn@ucdavis.edu
</code></pre></div></div>

<p>More information is available in the fin-server
<a href="https://github.com/UCDavisLibrary/fin-server/blob/master/docs/authentication-service/README.md">authentication-service</a>.
Implementors of alternative authentication schemes can look at the <a href="https://github.com/UCDavisLibrary/fin-server/tree/master/services/cas">CAS
Service</a>
for a good example of how this can be implemented for new authentication
services.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/fin-example-repository/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Fin Example Repository Documentation</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Fin Example Repository Documentation</li><li><a class="u-email" href="mailto:library@ucdavis.edu">library@ucdavis.edu</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/fin-example-repository/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/fin-example-repository/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>
</html>
